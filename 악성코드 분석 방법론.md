# 악성코드 분석 방법론
##### 작성자 : 김평일 대리, 김태현 사원
##### 작성일자 : 2024년 5월 23일
</br></br>

## (1) 분석 개념


## (2) 분석 도구

### 2-1 Sysmon

Sysmon은 System Monitoring의 줄임말로, 윈도우의 로그를 분석하는데 가장 일반적으로 사용되는 추가 도구 중 하나임. Sysmon을 사용하면 코드 동작과 네트워크 트래픽을 추적하여 악성 활동을 탐지할 수 있음

Sysmon은 현재 마이크로소프트가 소유하고 있는 패키지의 일부이며 별도의 다운로드와 다음과 같은 설치 과정을 거쳐주어야 함

다운로드 링크 : https://learn.microsoft.com/ko-kr/sysinternals/downloads/sysmon

`Sysmon.exe -i -n -h sha256`
- -i : Sysmon을 설치하라는 명령어
- -n : 네트워크 연결 모니터링을 활성화하는 옵션
- -h sha256 : 파일 생성 및 이미지 로딩 이벤트를 로깅할 때 sha256 알고리즘을 사용할 것을 지정

![image](https://github.com/ICTIS-Cert-System-Project/ICTIS-Cert-System/assets/18510716/704f5832-6973-424a-8556-67b809818766)

Sysmon 활용 방법임. (1)"이벤트 뷰어"를 오픈한 후 "응용 프로그램 및 서비스 로그 - Microsoft - Sysmon" 항목을 찾아서 "Operational" 항목을 클릭함.

Operational 항목을 선택하면 우측에 (2)날짜와 시간 순으로 Sysmon이 기록한 로그 정보가 표시되며, 특정 로그를 선택할 경우 하단의 (3)일반 항목에 세부 정보가 출력됨.

참고로, 이벤트 ID 별 상황은 다음과 같음.

(중요)<br>
ID 1 : Process Create - 프로세스 생성 시 발생<br>
ID 3 : Network Connection - 네트워크 연결 시 발생<br>
ID 5 : Process Terminate - 프로세스 종료 시 발생


### 2-2 Regshot

Regshot은 레지스트리의 스냅샷을 신속하게 촬영한 다음, 시스템 변경을 수행하거나 새 소프트웨어 제품을 설치한 후 수행되는 두 번째 스냅샷과 비교할 수 있는 오픈소스 레지스트리 비교 유틸리티임.

악성코드의 동적분석 시 활용되며, 악성 행위가 실행되기 전에 스냅샷을 찍고, 악성 행위가 실행된 후의 스냅샷을 찍어 이를 비교해 레지스트리의 수정 정보를 확인함.

다운로드 링크 : https://sourceforge.net/projects/regshot/

![image](https://github.com/ICTIS-Cert-System-Project/ICTIS-Cert-System/assets/18510716/56c93c58-035f-4bd9-bc48-020df1cd3aea)

Regshot을 실행하고, 1st shot과 2nd shot을 각각 클릭해서 레지스트리 파일을 두개 생성함. 이후 Compare을 클릭하여 변경된 부분을 확인

![image](https://github.com/ICTIS-Cert-System-Project/ICTIS-Cert-System/assets/18510716/f121bb72-a86e-4c89-948a-665912e98d8e)


### 2-3 Procmon

Procmon은 Process Monitor의 줄임말로, 프로세스의 분석과 디버깅을 하기 위해 레지스트리, 파일, 프로세스, 네트워크 동작 등을 **실시간으로 캡처하는 프로그램임**

다운로드 링크 : https://learn.microsoft.com/ko-kr/sysinternals/downloads/procmon

프로세스들 중, 검색하고자 하는 특정 프로세스만 필터링 할 수 있음

![image](https://github.com/ICTIS-Cert-System-Project/ICTIS-Cert-System/assets/18510716/4207b45c-293d-4ca2-bbe6-66318905fd02)

디폴드 필터를 모두 삭제 후

![image](https://github.com/ICTIS-Cert-System-Project/ICTIS-Cert-System/assets/18510716/b41c9e59-8794-4fea-8270-58a9b538b2a2)

모니터링 대상 프로세스의 이름을 입력함.

Process Name 선택, is 선택, (대상 프로세스) 입력, Include 선택, Add 클릭

![image](https://github.com/ICTIS-Cert-System-Project/ICTIS-Cert-System/assets/18510716/1b93558c-336b-4e76-8659-34776f389e80)

이후 수집한 로그를 외부로 내보내기하여 세부적인 분석을 수행할 수 있음.

![image](https://github.com/ICTIS-Cert-System-Project/ICTIS-Cert-System/assets/18510716/89b30301-3bf2-4224-8281-ec5f76558b14)

또한, AutoScroll 버튼을 활성화하여 새로운 이벤트를 실시간으로 확인할 수 있음.

cf) 필터 규칙 : Column 이름(PID, Operation 등) 동일한 경우 여러 규칙들이 OR Column 이름(PID, Operation 등) 다른 경우 여러 규칙들이 AND -> Operation 기준으로 필터링 ==> WriteFile, RegSetValue, SetBasicInfomationFile


### 2-4 Autoruns

Autoruns는 msconfig.exe의 확장된 도구로, 윈도우 시스템이 부팅 후 자동으로 시작되는 서비스 또는 프로그램 등을 모니터링 할 수 있는 도구임.
특정 악성코드의 경우 cmd.exe를 자동으로 실행시켜 프로세스를 유지하기에 이를 탐지하고 조치할 수 있음.

다운로드 링크 : https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns



### 2-5 Procexp

### 2-6 die

### 2-7 Hashtab

### 2-8 Pestudio
